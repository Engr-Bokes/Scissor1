{"version":3,"file":"urlController.js","sourceRoot":"","sources":["../../src/controllers/urlController.ts"],"names":[],"mappings":"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","sourcesContent":["import { Request, Response } from 'express';\r\nimport { createShortUrl, getAnalytics, getUrlByShortId } from '../services/urlService';\r\nimport { UrlModel } from '../models/urlModel';\r\n\r\nexport const shortenUrl = async (req: Request, res: Response) => {\r\n    const { originalUrl, customUrl } = req.body;\r\n    const userId = req.user?.id;\r\n\r\n    if (!userId || typeof userId !== 'string') {\r\n        return res.status(400).json({ message: 'Invalid user ID in token' });\r\n    }\r\n\r\n    try {\r\n        const { shortUrl, qrCode } = await createShortUrl(originalUrl, userId, customUrl);\r\n        console.log(`URL shortened: ${originalUrl} -> ${shortUrl}`); // Logging the shortened URL\r\n        res.status(201).json({ shortUrl, qrCode });\r\n    } catch (error) {\r\n        console.error('Error in shortenUrl:', error);\r\n        res.status(500).json({ message: 'Server Error', error });\r\n    }\r\n};\r\n\r\nexport const getUrlAnalytics = async (req: Request, res: Response) => {\r\n    const { code } = req.params;\r\n\r\n    try {\r\n        const analytics = await getAnalytics(code);\r\n        console.log(`Analytics retrieved for URL code: ${code}`); // Logging analytics retrieval\r\n        res.status(200).json(analytics);\r\n    } catch (error) {\r\n        console.error('Error in getUrlAnalytics:', error);\r\n        res.status(500).json({ message: 'Server Error', error });\r\n    }\r\n};\r\n\r\nexport const getUserUrls = async (req: Request, res: Response) => {\r\n    const userId = req.user?.id;\r\n\r\n    if (!userId || typeof userId !== 'string') {\r\n        return res.status(400).json({ message: 'Invalid user ID in token' });\r\n    }\r\n\r\n    try {\r\n        const urls = await UrlModel.find({ user: userId });\r\n        console.log(`URLs retrieved for user: ${userId}`); // Logging user URL retrieval\r\n        res.status(200).json(urls);\r\n    } catch (error) {\r\n        res.status(500).json({ message: 'Server Error', error });\r\n    }\r\n};\r\n\r\nexport const redirectToOriginalUrl = async (req: Request, res: Response) => {\r\n    const { code } = req.params;\r\n\r\n    try {\r\n        const originalUrl = await getUrlByShortId(code);\r\n\r\n        if (originalUrl) {\r\n            await UrlModel.findOneAndUpdate(\r\n                { urlCode: code },\r\n                { $inc: { clicks: 1 }, lastAccessed: new Date() }\r\n            );\r\n            console.log(`Redirecting to original URL: ${originalUrl}`); // Logging redirection\r\n            res.redirect(originalUrl);\r\n        } else {\r\n            console.warn(`URL not found for code: ${code}`); // Logging not found URL\r\n            res.status(404).send('URL not found');\r\n        }\r\n    } catch (error) {\r\n        console.error('Error in redirectToOriginalUrl:', error);\r\n        res.status(500).json({ message: 'Server Error', error });\r\n    }\r\n};\r\n"]}